<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <meta name="author" content="Francis Begyn">
    <meta name="description" content="My little place on the internet">
    <meta name="keywords" content="blog,developer,personal,linux,go,rust">

    <base href="https://about.francisbegyn.be">
    <title>
  Making debian packages on Arch Linux · francisbegyn
</title>

    <link rel="canonical" href="https://about.francisbegyn.be/posts/deb-packages-arch/">

    <link  rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700">
    <link rel="stylesheet" href="//cdn.rawgit.com/necolas/normalize.css/master/normalize.css">
    <link rel="stylesheet" href="https://about.francisbegyn.be/css/style.min.css">

    

    <link rel="icon" type="image/png" href="https://about.francisbegyn.be/images/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="https://about.francisbegyn.be/images/favicon-16x16.png" sizes="16x16">

    

    <meta name="generator" content="Hugo 0.46" />
  </head>

  <body>
    <main class="wrapper">
      <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="https://about.francisbegyn.be">
      francisbegyn
    </a>
    
    <ul class="navigation-list float-right">
      
      <li class="navigation-item">
        <a class="navigation-link" href="https://about.francisbegyn.be/posts/">Blog</a>
      </li>
      
      <li class="navigation-item">
        <a class="navigation-link" href="https://about.francisbegyn.be/about/">About</a>
      </li>
      
    </ul>
    
  </section>
</nav>


      <div class="content">
        
  <section class="container post">
  <article>
    <header>
      <h1 class="title">Making debian packages on Arch Linux</h1>
      <h2 class="date">August 16, 2018</h2>

      
    </header>

    

<p>Lately I&rsquo;ve been helping with a little APT repo, and it&rsquo;s been fun. The thing I struggled a bit with was making a <code>.deb</code> package on my system (&ldquo;Hey, did you know I use Arch Linux?&rdquo;). Not because this is badly documented, but a lot of the documentation is actually making use of <code>devscripts</code>, <code>dh_make</code> or other helpers, which for some unkown reason all refuse to work on my system. TBD what the cause of this is.</p>

<p>So I started doing things manually, and what follows are my notes on the process.<br />
<strong>DISCLAIMER</strong>: I&rsquo;m relatively sure people that know this better then me would yell at me for some of the things that I&rsquo;m about to write. So this is by no means a guide, this is so I won&rsquo;t forget how I did things.</p>

<h1 id="directory-structure">Directory structure</h1>

<p>Generally the layout of the directory is can be straigh forward. I&rsquo;ll use the example of my <code>prometheus</code> package.</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4">prometheus-2.3.2
├── DEBIAN
│   ├── compat
│   ├── control
│   ├── postinst
│   ├── postrm
│   └── rules
├── etc
│   └── prometheus
│       └── prometheus.yml
├── lib
│   └── systemd
│       └── system
│           └── prometheus.service
├── usr
│   └── bin
│       ├── prometheus
│       └── promtool
└── var
    └── lib
            └── prometheus</pre></div>
<p>Ignore the <code>DEBIAN</code> folder at the moment. All the other directories should remind you of some familiar structure, and indeed it does! This represents the were the files are going to go relatively to <code>/</code>. As you can see binaries, config files, &hellip; all end up in the places where they belong.</p>

<h2 id="debian-folder">DEBIAN folder</h2>

<p>The debian folder has all the things that are related to how the package gets installed, the meta data of the package and all the other wonderfull things that come with packaging.</p>

<h3 id="control">control</h3>

<p>Has all the meta data of the package. A minimal control file is mentioned below (all the field in there are required).</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4">Package: &lt;<span style="color:#fff;font-weight:bold">package</span> name&gt;
Version: &lt;<span style="color:#fff;font-weight:bold">package</span> version&gt;
Maintainer: &lt;maintainer&gt;
Architecture: &lt;any, i386, amd64, ...&gt; 
Description: &lt;description&gt;</pre></div>
<p>Most of it is pretty straight forward. Just the <code>Architecture</code> is something to pay attention to. And the <code>Description</code> can be extended with multi-line just by identing the next lines with a space.</p>

<h3 id="rules-postinst-postrm">rules, postinst, postrm</h3>

<p>All these are scripts, and it&rsquo;s important to remember that scripts have to be executable. The <code>rules</code> specify how the package is actually made. <code>postinst</code> and <code>postrm</code> are scripts that are executed after installation and removal of the packages. These are mostly used for file permissions.</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4">DEBIAN/rules
------------
<span style="color:#f00">#</span>!/usr/bin/make -f
<span style="color:#f00">#</span> See debhelper(<span style="color:#ff0;font-weight:bold">7</span>) (uncomment to enable)
<span style="color:#f00">#</span> output every command that modifies files on the build system.
<span style="color:#f00">#</span>export DH_VERBOSE = <span style="color:#ff0;font-weight:bold">1</span>


<span style="color:#f00">#</span> see FEATURE AREAS in dpkg-buildflags(<span style="color:#ff0;font-weight:bold">1</span>)
<span style="color:#f00">#</span>export DEB_BUILD_MAINT_OPTIONS = hardening=+all

<span style="color:#f00">#</span> see ENVIRONMENT in dpkg-buildflags(<span style="color:#ff0;font-weight:bold">1</span>)
<span style="color:#f00">#</span> <span style="color:#fff;font-weight:bold">package</span> maintainers to append CFLAGS
<span style="color:#f00">#</span>export DEB_CFLAGS_MAINT_APPEND  = -Wall -pedantic
<span style="color:#f00">#</span> <span style="color:#fff;font-weight:bold">package</span> maintainers to append LDFLAGS
<span style="color:#f00">#</span>export DEB_LDFLAGS_MAINT_APPEND = -Wl,--as-needed


%:
        dh <span style="color:#f00">$@</span> --with-systemd


<span style="color:#f00">#</span> dh_make generated override targets
<span style="color:#f00">#</span> This is example <span style="color:#fff;font-weight:bold">for</span> Cmake (See https:<span style="color:#007f7f">//bugs.debian.org/641051 )
</span><span style="color:#007f7f"></span><span style="color:#f00">#</span>override_dh_auto_configure:
<span style="color:#f00">#</span>       dh_auto_configure -- <span style="color:#f00">#</span>  -DCMAKE_LIBRARY_PATH=<span style="color:#f00">$</span>(DEB_HOST_MULTIARCH)</pre></div>
  </article>

  <br/>

  
  
</section>

      </div>

      <footer class="footer">
  <section class="container">
     © 2018    ·  Powered by <a href="https://gohugo.io/">Hugo</a> & <a href="https://github.com/luizdepra/hugo-coder/">Coder</a>. 
  </section>
</footer>

    </main>

    

  </body>

</html>
