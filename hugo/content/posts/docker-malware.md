+++ 
draft = false
date = 2018-06-17T01:38:45+02:00
title = "Docker, trustworthy or shady?"
slug = "maliciousdocker" 
tags = ["ipsec","docker","containerisation"]
categories = ["docker","security","ipsec"]
+++

When I saw the [article](https://kromtech.com/blog/security-center/cryptojacking-invades-cloud-how-modern-containerization-trend-is-exploited-by-attackers) about docker images on dockerhub being infected with cryptocurrency mining malware, I couldn't help but write something about my feelings about docker.

# Docker?

According to [wikipedia](https://en.wikipedia.org/wiki/Docker_(software))

> Docker is a computer program that performs operating-system-level virtualization also known as containerization.[6] It is developed by Docker, Inc.[7] Docker is primarily developed for Linux, where it uses the resource isolation features of the Linux kernel such as cgroups and kernel namespaces, and a union-capable file system such as OverlayFS and others[8] to allow independent "containers" to run within a single Linux instance, avoiding the overhead of starting and maintaining
> virtual machines (VMs).[9] The Linux kernel's support for namespaces mostly[10] isolates an application's view of the operating environment, including process trees, network, user IDs and mounted file systems, while the kernel's cgroups provide resource limiting for memory and CPU.[11] Since version 0.9, Docker includes the libcontainer library as its own way to directly use virtualization facilities provided by the Linux kernel, in addition to using abstracted
> virtualization interfaces via libvirt, LXC and systemd-nspawn.

Boy, that's a lot. In essention it comes down that Docker allows us to run software in little boxes as if it was running alone on a seperate server, while in reality all these boxes are running on the same server. It's something called [containerization](https://en.wikipedia.org/wiki/Operating-system-level_virtualization), and is wonderful.

# How I feel about it

First of all, I do mean it when I say it's wonderful. I use it myself when developing and testing things. The luxury of having a MySQL server or TICK stack up and running in seconds with just 1 simple cli command `docker run ...` is amazing. it safes me time and makes it so I can reproduce the same clean environment time and time again.

The thing is, I think that's where it belongs, in these short lived "tasks". Not in production. I don't trust it in production.
You could argue that the mining malware has nothing to do with docker itself, nor with using it in production. But I think it's just a symptom of a larger issue. The images on dockerhub are open and what is stopping (ignorant) people from just using the first hits of their search, without actually understanding what is happening.

Too many people just copy/paste code from the internet without actually understanding what it is doing, and the same is happening with containerization. People are just willing to let these containers run on their system, unbeknown to the damage they could cause.
By not using docker in production, I'm forcing myself and others to at least know what software you are installing, how it is configured and how the environment of it is configured.

I would like to mention that I'm aware of the amount of lockdown you can do with docker, I just don't think a lot of the images floating around out there apply this kind of lockdown.

# Case in point - traefik container

I use traefik, but not with the docker image or the docker config. Even though the documentation mentions docker extensively. The problem with it is that the [default guide](https://docs.traefik.io/configuration/backends/docker/) is to expose the docker socket in the config. Since this is a container you would expose to the internet, you have to keep security in mind.
If the traefik container would ever get tainted, the attacker could use the socket to gain access to the docker host. 

Instead, I installed the binary myself and configure the frontends and backends manually instead of having them being auto discovered through the docker sockets. Doing this I learned a lot more about how Traefik works and I picked up some systemd service writing skill.

# Conclussion

So is docker trustworthy? Yes, when used properly and deployed by capable people.
I'm always open for people to proof me wrong about this, so feel free to hit me up on [twitter](https://twitter.com/fbegyn)
