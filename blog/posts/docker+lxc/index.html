<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	
	<title>Docker&#43;lxc: some nesting required</title>
	
	<meta name="description" content="">
	<meta name="image" content="">
	
	<meta itemprop="name" content="Docker&#43;lxc: some nesting required">
	<meta itemprop="description" content="">
	<meta itemprop="image" content="">
	
	<meta name="og:title" content="Docker&#43;lxc: some nesting required">
	<meta name="og:description" content="">
	
	<meta name="og:url" content="https://blog.francisbegyn.be/posts/docker&#43;lxc/">
	<meta name="og:site_name" content="Docker&#43;lxc: some nesting required">
	<meta name="og:type" content="article">
	
	<meta name="article:tag" content="">
	<link rel="stylesheet" type="text/css" href="https://blog.francisbegyn.be/css/style.css">
	
	
	
	<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css">
	<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
	<script>hljs.initHighlightingOnLoad();</script>

</head>

<body>

<header>
	
	<a href="https://blog.francisbegyn.be/" style="float: left;color:#777;"><strong>Francis Begyn</strong></a>
	
	&nbsp;&nbsp;&nbsp;&nbsp;
	
	
	
	<a href="https://blog.francisbegyn.be/index.xml" style="color:#777;float: right;"><strong><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></strong></a>
</header>


<div id="loadingMask" style="width: 100%; height: 100%; position: fixed; background: #fff;"></div>
<script>
function fadeOut(el) {
  el.style.opacity = 1;

  var last = +new Date();
  var tick = function() {
    el.style.opacity = +el.style.opacity - (new Date() - last) / 80;
    last = +new Date();
    

    if (el.style.opacity > 0) {
      (window.requestAnimationFrame && requestAnimationFrame(tick)) || setTimeout(tick, 16);
    } else {
      el.style.display='none';
    }
  };

  tick();
}

function ready(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
         el = document.getElementById('loadingMask');
         fadeOut(el);
        var elements = document.querySelectorAll("img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("alt")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("alt"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });

    } else {
        document.addEventListener('DOMContentLoaded', fn);
    }
}
window.onload = ready;
</script>

<div class="content">
  <h1>Docker&#43;lxc: some nesting required <aside></aside></h1>
  <p>I&rsquo;m a huge fan of doing things with docker and lxc, but I&rsquo;ve never tried to run them together or really had a need to do so. Recently I run into trouble doing exactly that, seems like my lxc configuration and docker really didn&rsquo;t wanna play together.</p>

<p>Every time I wanted to spin up a docker container inside an lxc container, it ran into problems whenever it had to mount filesystems. As it turns out, you need to enable nesting in the lxc container to make this work.</p>

<p>First we need to stop the container if it&rsquo;s running</p>

<pre><code>lxc stop &lt;container&gt;
</code></pre>

<p>After which we can modify to container configuration and start it back up</p>

<pre><code>lxc config set &lt;container&gt; security.nesting true
lxc start &lt;container&gt;
</code></pre>

<p>If you know the container is gonna need nesting, you can also set it at creation</p>

<pre><code>lxc launch &lt;image&gt; -p &lt;profile&gt; &lt;name&gt; -c security.nesting true
</code></pre>

<p>In case the containers need to be priviliged, there&rsquo;s the flag <code>security.privileged true</code>.</p>

</div>




<footer>
	<p>Â© 2017-2018, all rights reserved.</a>
</footer>
</body>
</html>
